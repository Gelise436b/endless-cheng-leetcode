
---

### 📝 单题笔记：[1052] 爱生气的书店老板

#### 🎯 题意简述  
- 给定两个数组：
  - `customers[i]`：第 `i` 分钟进店顾客数；
  - `grumpy[i]`：老板状态（`0` 表示不生气 → 顾客满意；`1` 表示生气 → 顾客不满意）；
- 老板可使用一次“秘密技巧”，在**连续 `minutes` 分钟内保持不生气**；
- **目标**：最大化**总满意顾客数**。

> 💡 关键观察：  
> - **不生气时的顾客始终满意** → 这部分是**固定收益**；  
> - **生气时的顾客本会流失**，但若被技巧覆盖 → 可**额外挽回**；  
> - 因此，问题转化为：**选择一个长度为 `minutes` 的窗口，使得其中 `grumpy[i]==1` 的 `customers[i]` 之和最大**。

---

#### ❌ 初期误区（典型思维陷阱）
> “需要分别对生气/不生气顾客维护两个滑动窗口，甚至用二维数组记录前缀和。”

**错误原因**：  
- 混淆了**固定部分**与**可变部分**；
- 不生气顾客的满意度**与技巧无关**，无需滑窗；
- 生气顾客的挽回量**仅取决于技巧窗口位置**，只需一维滑窗。

✅ 正确认知：**答案 = 固定满意度 + 可挽回满意度的最大值**，二者完全解耦。

---

#### 🧠 正确建模思路
将总满意度拆解为两部分：

1. **基础满意度（固定）**：  
 
   —— 可在一次遍历中累加，或如代码中用 `s[0]` 累计。

2. **可提升满意度（可变）**：  
   在任意连续 `minutes` 窗口中，  
   —— 使用**定长滑动窗口**求 `extra` 的最大值 `max_extra`。

最终答案：`base + max_extra`

---

#### 🛠 参考代码解析（高效一维滑窗）
```cpp
class Solution {
public:
    int maxSatisfied(vector<int>& customers, vector<int>& grumpy, int minutes) {
        int s[2]{};      // s[0]: 不生气顾客总和（固定）；s[1]: 当前窗口内生气顾客和（滑动）
        int max_s1 = 0;  // 记录 s[1] 的最大值

        for (int i = 0; i < customers.size(); ++i) {
            s[grumpy[i]] += customers[i];  // 按状态累加

            int left = i - minutes + 1;    // 窗口左边界
            if (left >= 0) {
                max_s1 = max(max_s1, s[1]);                     // 更新最大可挽回值
                s[1] -= grumpy[left] ? customers[left] : 0;     // 滑出左边界（仅当当时生气才减）
            }
        }
        return s[0] + max_s1;
    }
};
```

> ✅ **关键细节**：
> - `s[0]` 在循环结束后即为完整的基础满意度；
> - `s[1]` 始终表示**当前窗口 `[i−minutes+1, i]` 内生气顾客的总和**；
> - 窗口未满时（`left < 0`）不更新 `max_s1`，避免无效比较。

---

#### ⚠️ 易错点 & 边界处理
| 陷阱 | 正确处理 |
|------|--------|
| 在窗口未满时就更新 `max_s1` | 仅当 `left >= 0`（窗口长度 = `minutes`）时更新 |
| 滑出时无条件减 `customers[left]` | 必须判断 `grumpy[left]`：只有生气时才计入过 `s[1]` |
| 试图用二维数组或前缀和 | 不必要！状态分离后只需两个变量 |

---

#### 🌟 思想升华
- **状态分离原则**：当问题包含**不可变基础 + 可变增量**时，优先拆解计算；
- **滑窗作用域精准定位**：仅对“受操作影响的部分”（生气时段）应用滑窗；
- **空间优化典范**：用 `s[2]` 替代两个独立变量，简洁且不失可读性；
- **通用模型**：  
  > “**固定收益 + 滑窗内可变收益最大值**” 是一类经典范式，可迁移至信号增强、资源调度等场景。

---

#### 🔁 对比同类题
| 题目 | 固定部分 | 可变部分（滑窗目标） |
|------|--------|------------------|
| [1052] 爱生气的书店老板 | `grumpy=0` 的顾客 | `grumpy=1` 的顾客在 `minutes` 窗口内的最大和 |
| [3679] 库存平衡 | 无 | 保留序列的合法性维护（最小丢弃） |
| [2107] 分享糖果 | 无 | 剩余集合的种类数最大 |

> ✅ 共性：**识别“什么不受操作影响”是简化问题的第一步。**

---

> 📌 **一句话总结**：  
> **“不生气的全拿，生气的选一段最好的用技巧挽回——答案 = 基础 + 最大挽回。”**
